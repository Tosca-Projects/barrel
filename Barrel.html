<!DOCTYPE html>
<html>
<head>
	<title>Barrel</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <!--LINKS-->
    <link rel="shortcut icon" href="img/barrel_icon.ico"/>
	<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/joint.css" rel="stylesheet" type="text/css">
    <link href="css/devs.css" rel="stylesheet" type="text/css">
    <link href="css/editor.css" rel="stylesheet" type="text/css">
    <!--jQuery-->
    <script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.js"></script>
    <!--Required JS Libraries-->
    <script type="text/javascript" src="lib/lodash.min.js"></script>
    <script type="text/javascript" src="lib/backbone.min.js"></script>
    <script type="text/javascript" src="lib/bootstrap.min.js"></script>
    <!--JS libraries for graphics-->
    <script type="text/javascript" src="lib/joint.js"></script>
    <script type="text/javascript" src="lib/jsplumb/dist/js/jquery.jsPlumb-1.7.2-min.js"></script>
	<script type="text/javascript" src="lib/zip.js"></script>
	<script type="text/javascript" src="lib/zip-fs.js"></script>
	<!--Typescript generated-->
	<script src="TOSCA.js"></script>
    <script src="csar.js"></script>
    <script src="EditorUtilities.js"></script>
    <script src="ManagementProtocols.js"></script>
	<script src="TOSCAAnalysis.js"></script>
    <script src="Analysis.js"></script>
    <script src="Simulator.js"></script>
    <!--JS Inline-->
	<script type="text/javascript">
        function qualifyURL(url) {
            var img = document.createElement('img');
	        img.src = url; // set string url
	        url = img.src; // get qualified url
	        img.src = null; // no server request
	        return url;
        }
        zip.workerScriptsPath = qualifyURL("lib/");
	</script>
    <script>
        $(document).ready(function(){
            $('[data-toggle="popover"]').popover();
        });
    </script>	  
</head>
<body>
    <!--Navigation bar-->
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Barrel</a>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="#visualiser" class="hidden">Visualise</a></li>
                    <li><a href="#editor" class="hidden">Edit</a></li>
                    <li><a href="#simulator" class="hidden">Simulate</a></li>
                    <li><a href="#analyser" class="hidden">Analyse</a></li>
                    <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">CSAR<span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a class="hidden" onclick="exportCsar()">Export</a></li>
                        <li><a onclick="$('#file-input')[0].click()">Import <input type="file" id="file-input" style="display: none"/></a></li>
                    </ul>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a data-toggle="modal" data-target="#modal-info">About</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!--Application topology-->
    <h1 id="visualiser" class="col-lg-10 hidden" style="margin-top:65px">Visualiser</h1>
    <form class="col-lg-10" style="width:95%">
        <fieldset>
            <legend class="hidden">
                <a class="legend" id="application-name"></a>: Application topology
            </legend>
            <table style="width:100%;text-align:center">
                <tr>
                    <td style="width:40%">
                        <div id="app-topology" style="position: relative"></div> 
                    </td>
                    <td style="width:60%">
                        <div style="font-size:90%;margin-left:10px">
                            <table class="table table-striped table-hover hidden">
                                <thead>
                                    <tr class="btn-primary disabled">
                                        <th>Node</th>
                                        <th>Node type</th>
                                        <th>Capabilities</th>
                                        <th>Requirements</th>
                                        <th>Operations</th>
                                    </tr>
                                </thead>
                                <tbody id="topology-table-body"></tbody>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
                     
        </fieldset>
    </form> 

    <!-- Editor -->
    <h1 id="editor" class="col-lg-10 hidden">Editor</h1>
    <fieldset class="col-lg-10 hidden">
        <legend>
            <a class="legend" id="management-protocol-node-type-name" onclick="exportXMLDoc()"></a>: Management Protocol
            <button type="button" class="btn btn-info btn-xs" data-container="body" data-toggle="popover" data-placement="right" data-content="To edit a management protocol, (i) double click on a topology node, or (ii) click on row of the corresponding table." data-original-title="" title="">info</button>
        </legend>
        <table class="table">
            <tbody>
                <tr>
                    <td style="width:70%">
                        <pre id="management-protocol-display"></pre>
                    </td>
                    <td style="width:30%">
                        <form class="form-horizontal">
                            <fieldset>
                                <legend>Edit</legend>
                                <div class="col-lg-10"><label class="control-label">Initial state</label></div>
                                <div class="col-lg-10" style="width:80%"><select class="form-control state-selector" id="initial-state-selector"></select></div>
                                <div class="col-lg-10"><label class="control-label">Requirement assumptions</label></div>
                                <div class="col-lg-10 btn-group btn-group-justified" style="width:80%">
                                    <a class="btn btn-primary" data-toggle="modal" data-target="#modal-requirement-editor" onclick="buildModalEditor('Add','requirement')">Add</a>
                                    <a class="btn btn-info" data-toggle="modal" data-target="#modal-requirement-editor" onclick="buildModalEditor('Remove','requirement')">Remove</a>
                                </div>
                                <div class="col-lg-10"><label class="control-label">Provisioned capabilities</label></div>
                                <div class="col-lg-10 btn-group btn-group-justified" style="width:80%">
                                    <a class="btn btn-primary" data-toggle="modal" data-target="#modal-capability-editor" onclick="buildModalEditor('Add','capability')">Add</a>
                                    <a class="btn btn-info" data-toggle="modal" data-target="#modal-capability-editor" onclick="buildModalEditor('Remove','capability')">Remove</a>
                                </div>
                                <div class="col-lg-10"><label class="control-label">Transitions</label></div>
                                <div class="col-lg-10 btn-group btn-group-justified" style="width:80%">
                                    <a class="btn btn-primary" data-toggle="modal" data-target="#modal-transition-editor" onclick="buildModalTransitionEditor('Add')">Add</a>
                                    <a class="btn btn-info" data-toggle="modal" data-target="#modal-transition-editor" onclick="buildModalTransitionEditor('Remove')">Remove</a>
                                </div>
                                <div class="col-lg-10"><label class="control-label">Fault handlers</label></div>
                                <div class="col-lg-10 btn-group btn-group-justified" style="width:80%">
                                    <a class="btn btn-primary" data-toggle="modal" data-target="#modal-fault-editor" onclick="buildModalFaultEditor('Add')">Add</a>
                                    <a class="btn btn-info" data-toggle="modal" data-target="#modal-fault-editor" onclick="buildModalFaultEditor('Remove')">Remove</a>
                                </div>
                            </fieldset>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
    
    <!-- Editor's modals-->
    <div id="modal-requirement-editor" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Requirement assumption</h4>
                </div>
                <div class="modal-body">
                    <label class="control-label">State:</label>
                    <select id="requirement-state-selector" class="form-control state-selector"></select>
                    <label class="control-label">Requirement to be assumed:</label>
                    <select id="requirement-selector" class="form-control"></select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="requirement-editor-confirm" type="button" class="btn btn-primary" data-dismiss="modal"></button>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-capability-editor" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Capability offering</h4>
                </div>
                <div class="modal-body">
                    <label class="control-label">State:</label>
                    <select id="capability-state-selector" class="form-control state-selector"></select>
                    <label class="control-label">Offered capability:</label>
                    <select id="capability-selector" class="form-control"></select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="capability-editor-confirm" type="button" class="btn btn-primary" data-dismiss="modal"></button>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-transition-editor" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Transition</h4>
                </div>
                <div class="modal-body">
                    <label class="control-label">Starting state:</label>
                    <select id="transition-starting-state-selector" class="form-control state-selector"></select>
                    <label class="control-label">Operation:</label>
                    <select id="transition-operation-selector" class="form-control"></select>
                    <label class="control-label transition-hide-show">Target state:</label>
                    <select id="transition-target-state-selector" class="form-control state-selector transition-hide-show"></select>
                    <label class="control-label transition-hide-show">Needed requirements:</label>
                    <div class="form-group transition-hide-show">
                        <div id="transition-requirements-checkbox" class="checkbox">
                            <label><input id="checkbox" value="Checkbok" type="checkbox"> Checkbox</label>
                            <label><input id="checkbox" value="Checkbok" type="checkbox"> Checkbox</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="transition-editor-confirm" type="button" class="btn btn-primary" data-dismiss="modal"></button>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-fault-editor" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Fault handler</h4>
                </div>
                <div class="modal-body">
                    <label class="control-label">Starting state:</label>
                    <select id="fault-starting-state-selector" class="form-control state-selector"></select>
                    <label class="control-label transition-hide-show">Faulted requirements that are handled:</label>
                    <div class="form-group">
                        <div id="fault-requirements-checkbox" class="checkbox">
                            <label><input id="checkbox" value="Checkbok" type="checkbox"> Checkbox</label>
                            <label><input id="checkbox" value="Checkbok" type="checkbox"> Checkbox</label>
                        </div>
                    </div>
                    <label class="control-label fault-hide-show">Target state:</label>
                    <select id="fault-target-state-selector" class="form-control state-selector fault-hide-show"></select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="fault-editor-confirm" type="button" class="btn btn-primary" data-dismiss="modal"></button>
                </div>
            </div>
        </div>
    </div>

    <!--Simulator-->
    <h1 id="simulator" class="col-lg-10 hidden">Simulator</h1>
    <table class="table table-striped table-hover ">
        <thead>
            <tr>
                <th style="width:10%"></th>
                <th style="width:10%">State</th>
                <th style="width:25%">Offered capabilities</th>
                <th style="width:25%">Assumed requirements</th>
                <th style="width:30%">Available operations</th>
            </tr>
        </thead>
        <tbody id="simulator-body">
        </tbody>
    </table>
    <div class="form-horizontal col-lg-10 hidden" style="text-align:center">
        <button type="button" class="btn btn-default btn-xs" onclick="buildSimulator()">Clear</button>
    </div>

    <!--Analyser-->
    <h1 id="analyser" class="col-lg-10 hidden">Analyser</h1>
    <div class="col-lg-10 hidden" style="color:red;font-weight:bold">THIS IS A PLACEHOLDER FOR ALL TO-BE-IMPLEMENTED ANALYSES</div>

    <!--"About" dialog-->
    <div id="modal-info" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">About</h4>
                </div>
                <div class="modal-body">
                    <p>
                        This editor has been developed in the scope of the research paper "TBD TBD TBD".
                    </p>
                    <center>
                        <p>

                            You can download a sample CSAR by clicking <a href="https://github.com/ranma42/MProt/blob/wip/localzip/test/MotivatingScenario.csar?raw=true">here</a>.
                        </p>
                    </center>
                    <p>
                        Copyright &copy;: A. Canciani, J. Soldani (Dip. di Informatica, Università di Pisa, Italia).
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
	<script src="Barrel.js"></script>
</body>
</html>
